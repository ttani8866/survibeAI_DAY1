# 001_お問合せフォーム機能

## 1. ユーザーニーズ

### 背景
- ユーザーがサービスに関する質問や要望を送信できる窓口が必要
- 管理者が問い合わせ内容を確実に受け取り、対応できる仕組みが必要

### 期待される体験
- ユーザーは簡単な入力フォームから問い合わせを送信できる
- 入力ミスがあった場合は即座にエラーメッセージが表示される
- 送信完了後は確認画面が表示され、送信成功を実感できる
- 管理者はメールで通知を受け取り、DBでも履歴を確認できる

---

## 2. 仕様要件

### 2.1 画面仕様

#### お問合せフォーム画面（/contact）
| 項目 | 仕様 |
|------|------|
| URL | `/contact` |
| フォームフィールド | 名前、メールアドレス、件名、本文 |
| UIコンポーネント | MUI TextField, Button |
| レスポンシブ | モバイル対応 |

#### 入力フィールド詳細
| フィールド名 | 型 | 必須 | バリデーション |
|-------------|-----|------|---------------|
| name | string | ✓ | 1文字以上 |
| email | string | ✓ | メールアドレス形式 |
| subject | string | ✓ | 1文字以上 |
| message | string | ✓ | 1文字以上 |

### 2.2 API仕様

#### POST /api/contact
| 項目 | 内容 |
|------|------|
| メソッド | POST |
| Content-Type | application/json |
| リクエストボディ | `{ name, email, subject, message }` |
| 成功レスポンス | `{ success: true, message: "送信完了" }` |
| エラーレスポンス | `{ success: false, error: "エラー内容" }` |

### 2.3 データベース仕様

#### Contactモデル（MongoDB/Mongoose）
| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| name | String | ✓ | 送信者名 |
| email | String | ✓ | メールアドレス |
| subject | String | ✓ | 件名 |
| message | String | ✓ | 本文 |
| createdAt | Date | ✓ | 送信日時（自動） |

---

## 3. 処理手順設計

### 3.1 フロントエンド処理フロー

```
[ユーザー] フォーム入力
    ↓
[クライアント] 入力バリデーション
    ↓ (エラーあり → エラーメッセージ表示)
    ↓ (OK)
[クライアント] APIへPOSTリクエスト送信
    ↓
[クライアント] ローディング状態表示
    ↓
[クライアント] レスポンス受信
    ↓ (成功 → 完了画面表示)
    ↓ (失敗 → エラーメッセージ表示)
```

### 3.2 バックエンド処理フロー

```
[API] リクエスト受信
    ↓
[API] リクエストボディのバリデーション
    ↓ (エラー → 400レスポンス)
    ↓ (OK)
[API] MongoDBへContact保存
    ↓ (エラー → 500レスポンス)
    ↓ (OK)
[API] Nodemailerで管理者へメール送信
    ↓ (エラー → ログ出力のみ、処理継続)
    ↓ (OK)
[API] 成功レスポンス返却
```

### 3.3 ファイル構成

```
src/
├── app/
│   ├── contact/
│   │   └── page.tsx          # お問合せフォーム画面
│   └── api/
│       └── contact/
│           └── route.ts      # APIエンドポイント
├── lib/
│   └── mongodb.ts            # MongoDB接続ユーティリティ
└── models/
    └── Contact.ts            # Mongooseモデル
```

---

## 4. 実装状態

✅ **実装完了**

- お問合せフォーム画面（/contact）
- 入力バリデーション（必須チェック、メール形式チェック）
- API Route（/api/contact）
- Mongooseモデル（Contact）
- 送信完了画面表示
- Nodemailerでの管理者メール送信（環境変数設定時）
