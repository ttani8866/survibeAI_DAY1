# Google認証機能 動作確認チェックリスト

## 概要
NextAuth.js v4 を使用したGoogle認証機能の動作確認チェックリストです。

---

## テスト環境
- **開発環境URL**: http://localhost:3000
- **本番環境URL**: https://your-vercel-domain.vercel.app
- **テスト日**: ____年__月__日
- **テスト担当者**: ________________

---

## 事前準備

| # | 確認項目 | 状態 |
|---|---------|------|
| 1 | 開発サーバーが起動している（`pnpm dev`） | □ |
| 2 | `.env.local` に環境変数が設定されている | □ |
| 3 | Google Cloud Consoleでテストユーザーが追加されている | □ |

---

## 動作確認項目

### 1. ログインボタンの表示

| # | 確認項目 | 期待結果 | 結果 |
|---|---------|---------|------|
| 1-1 | `/auth/signin` にアクセス | ログイン画面が表示される | □ OK / □ NG |
| 1-2 | 「Googleでログイン」ボタンが表示される | ボタンが見える | □ OK / □ NG |
| 1-3 | ボタンのデザインが正常 | Googleアイコン付きボタン | □ OK / □ NG |

---

### 2. ログインボタンクリックでGoogleログイン画面に遷移

| # | 確認項目 | 期待結果 | 結果 |
|---|---------|---------|------|
| 2-1 | 「Googleでログイン」ボタンをクリック | Googleの認証画面に遷移 | □ OK / □ NG |
| 2-2 | Google認証画面のURL | `accounts.google.com` で始まる | □ OK / □ NG |
| 2-3 | OAuth同意画面が表示される | アプリ名が表示される | □ OK / □ NG |

---

### 3. Googleアカウント選択後、アプリにリダイレクト

| # | 確認項目 | 期待結果 | 結果 |
|---|---------|---------|------|
| 3-1 | Googleアカウントを選択 | 「次へ」ボタンが表示される | □ OK / □ NG |
| 3-2 | 「次へ」をクリック | アプリにリダイレクトされる | □ OK / □ NG |
| 3-3 | エラーなくリダイレクト完了 | URLにerrorパラメータがない | □ OK / □ NG |

---

### 4. ログイン成功後、ダッシュボードに遷移

| # | 確認項目 | 期待結果 | 結果 |
|---|---------|---------|------|
| 4-1 | リダイレクト先のURL | `/dashboard` に遷移 | □ OK / □ NG |
| 4-2 | ダッシュボード画面が表示される | 「ようこそ、○○さん！」と表示 | □ OK / □ NG |
| 4-3 | ユーザー情報が正しく表示される | 名前がGoogleアカウントと一致 | □ OK / □ NG |

---

### 5. ヘッダーにユーザー名とアバター表示

| # | 確認項目 | 期待結果 | 結果 |
|---|---------|---------|------|
| 5-1 | ヘッダー右上にユーザー名表示 | Googleアカウント名が表示 | □ OK / □ NG |
| 5-2 | アバター画像が表示される | Googleプロフィール画像または頭文字 | □ OK / □ NG |
| 5-3 | ログアウトボタンが表示される | ボタンがクリック可能 | □ OK / □ NG |

---

### 6. ログアウトボタンクリックでログアウト

| # | 確認項目 | 期待結果 | 結果 |
|---|---------|---------|------|
| 6-1 | ログアウトボタンをクリック | セッションが終了する | □ OK / □ NG |
| 6-2 | ヘッダーの表示が変わる | ログインボタンに変わる | □ OK / □ NG |

---

### 7. ログアウト後、トップページにリダイレクト

| # | 確認項目 | 期待結果 | 結果 |
|---|---------|---------|------|
| 7-1 | ログアウト後のURL | `/` （トップページ）に遷移 | □ OK / □ NG |
| 7-2 | トップページが正常に表示される | ランディングページが表示 | □ OK / □ NG |

---

### 8. 未認証で/dashboardアクセス時、ログイン画面にリダイレクト

| # | 確認項目 | 期待結果 | 結果 |
|---|---------|---------|------|
| 8-1 | ログアウト状態で `/dashboard` にアクセス | ログイン画面にリダイレクト | □ OK / □ NG |
| 8-2 | リダイレクト先のURL | `/auth/signin` に遷移 | □ OK / □ NG |
| 8-3 | シークレットモードで `/dashboard` にアクセス | ログイン画面にリダイレクト | □ OK / □ NG |

---

### 9. MongoDBにユーザー情報が保存されている

| # | 確認項目 | 期待結果 | 結果 |
|---|---------|---------|------|
| 9-1 | MongoDBのusersコレクションを確認 | ユーザードキュメントが存在 | □ OK / □ NG |
| 9-2 | nameフィールド | Googleアカウント名と一致 | □ OK / □ NG |
| 9-3 | emailフィールド | Googleメールアドレスと一致 | □ OK / □ NG |
| 9-4 | imageフィールド | プロフィール画像URLが保存 | □ OK / □ NG |
| 9-5 | createdAtフィールド | タイムスタンプが保存 | □ OK / □ NG |

#### MongoDB確認コマンド

```bash
# MongoDB Shellで確認
mongosh "mongodb+srv://your-cluster.mongodb.net/your-database"

# usersコレクションを確認
db.users.find().pretty()

# 特定のユーザーを検索
db.users.findOne({ email: "your-email@gmail.com" })
```

---

## テスト結果サマリー

| カテゴリ | 項目数 | OK | NG | 備考 |
|---------|--------|----|----|------|
| ログインボタン表示 | 3 | | | |
| Google画面遷移 | 3 | | | |
| アプリリダイレクト | 3 | | | |
| ダッシュボード遷移 | 3 | | | |
| ヘッダー表示 | 3 | | | |
| ログアウト | 2 | | | |
| リダイレクト | 2 | | | |
| 認証保護 | 3 | | | |
| MongoDB保存 | 5 | | | |
| **合計** | **27** | | | |

---

## 問題点・備考

```
（テスト中に発見した問題点や特記事項を記載）




```

---

## 環境変数チェックリスト

`.env.local` に以下が設定されていることを確認：

| 変数名 | 設定済み |
|--------|---------|
| `NEXTAUTH_SECRET` | □ |
| `NEXTAUTH_URL` | □ |
| `GOOGLE_CLIENT_ID` | □ |
| `GOOGLE_CLIENT_SECRET` | □ |
| `MONGODB_URI` | □ |

---

## 作成日
2024年12月14日

## 関連ドキュメント
- `tasks/002_Google認証機能/設計書.md`

